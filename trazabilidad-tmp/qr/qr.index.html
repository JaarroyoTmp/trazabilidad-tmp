<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>TMP · QR Label Studio</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- QR LIB -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>
/* ===== PANTALLA ===== */
body{
  background:#0b1220;
  color:#eaf2ff;
  font-family:system-ui,-apple-system,Segoe UI,sans-serif;
  margin:0;
  padding:30px;
  display:flex;
  justify-content:center;
}

.panel{
  background:#111c33;
  border-radius:18px;
  padding:22px;
  width:360px;
  box-shadow:0 20px 40px rgba(0,0,0,.55);
}

label{
  font-size:13px;
  color:#a0b3cc;
}

input{
  width:100%;
  padding:10px;
  margin-top:6px;
  border-radius:10px;
  border:1px solid #2a3556;
  background:#070b12;
  color:#fff;
  font-size:15px;
}

button{
  margin-top:12px;
  padding:10px;
  border-radius:999px;
  border:none;
  font-weight:800;
  cursor:pointer;
}

.btn-main{
  background:#22c55e;
  color:#04120a;
}

.btn-print{
  background:#58a6ff;
  color:#041324;
}

.sizes{
  display:flex;
  gap:8px;
  margin-top:12px;
}

.sizes button{
  flex:1;
  background:#1f2937;
  color:#cfe6ff;
}

.sizes button.active{
  background:#58a6ff;
  color:#041324;
}

.preview{
  margin-top:18px;
  display:flex;
  justify-content:center;
}

.qr-wrapper{
  background:#fff;
  padding:12px;
}

canvas{
  image-rendering: pixelated;
}

.info{
  margin-top:10px;
  font-size:12px;
  color:#a0b3cc;
  word-break:break-all;
}

/* ===== IMPRESIÓN ===== */
@media print{
  body{
    background:#fff;
    padding:0;
  }

  .panel{
    box-shadow:none;
    border-radius:0;
    width:auto;
    padding:0;
  }

  button, input, .sizes, .info{
    display:none !important;
  }

  .qr-wrapper{
    padding:0;
  }

  canvas{
    image-rendering: pixelated;
  }
}
</style>
</head>

<body>

<div class="panel">
  <label>Código del instrumento</label>
  <input id="codigo" placeholder="Ej: 11217">

  <button class="btn-main" onclick="generarQR()">Generar QR</button>
  <button class="btn-print" onclick="window.print()">Imprimir</button>

  <div class="sizes">
    <button class="active" onclick="setSize(10,this)">10 mm</button>
    <button onclick="setSize(13,this)">13 mm</button>
    <button onclick="setSize(15,this)">15 mm</button>
  </div>

  <div class="preview">
    <div class="qr-wrapper" id="qr"></div>
  </div>

  <div class="info" id="info"></div>
</div>

<script>
const BASE_URL = "https://trazabilidad-tmp.vercel.app/qr/qr.info_instrumentos.html?codigo=";

let sizeMM = 10;

function mmToPx(mm){
  return Math.round(mm * 96 / 25.4);
}

function setSize(mm,btn){
  sizeMM = mm;
  document.querySelectorAll(".sizes button").forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");
  if(document.getElementById("codigo").value) generarQR();
}

function generarQR(){
  const codigo = document.getElementById("codigo").value.trim();
  if(!codigo){
    alert("Introduce un código");
    return;
  }

  const url = BASE_URL + encodeURIComponent(codigo);
  const finalPx = mmToPx(sizeMM);

  const cont = document.getElementById("qr");
  cont.innerHTML = "";

  /* 1️⃣ QR GRANDE (CALIDAD MÁXIMA) */
  const tmp = document.createElement("div");
  new QRCode(tmp,{
    text:url,
    width:1000,
    height:1000,
    correctLevel:QRCode.CorrectLevel.H
  });

  const bigCanvas = tmp.querySelector("canvas");

  /* 2️⃣ REDUCCIÓN LIMPIA (SIN SUAVIZADO) */
  const canvas = document.createElement("canvas");
  canvas.width = finalPx;
  canvas.height = finalPx;

  const ctx = canvas.getContext("2d");
  ctx.imageSmoothingEnabled = false;
  ctx.drawImage(bigCanvas,0,0,finalPx,finalPx);

  cont.appendChild(canvas);

  document.getElementById("info").innerText =
    "QR → " + url + " | Tamaño real: " + sizeMM + "×" + sizeMM + " mm";
}
</script>

</body>
</html>


