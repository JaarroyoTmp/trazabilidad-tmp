<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TMP 路 Generador de C贸digos QR</title>

<!-- Librer铆a QR -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>
  body{
    margin:0;
    font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    background:#0d1117;
    color:#f0f6fc;
  }
  header{
    display:flex;
    align-items:center;
    gap:14px;
    padding:14px 16px;
    background:#161b22;
    border-bottom:1px solid #30363d;
  }
  header img.logo{height:40px}
  header h1{margin:0;font-size:18px}
  header span.sub{font-size:12px;color:#8b949e}

  .wrap{
    max-width:460px;
    margin:22px auto;
    padding:0 16px 32px;
  }

  .card{
    background:#161b22;
    border-radius:16px;
    border:1px solid #30363d;
    padding:20px 16px;
  }

  h2{margin:0 0 10px;font-size:16px}
  label{display:block;font-size:13px;color:#8b949e;margin-bottom:4px}

  input{
    width:100%;
    padding:10px 12px;
    border-radius:10px;
    border:1px solid #30363d;
    background:#0d1117;
    color:#f0f6fc;
    font-size:14px;
    outline:none;
  }

  input:focus{border-color:#58a6ff;}

  .row{
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    margin-top:12px
  }

  button{
    border:none;
    border-radius:999px;
    padding:9px 16px;
    font-size:14px;
    cursor:pointer;
    font-weight:600;
  }

  .btn-main{background:#238636;color:#fff;}
  .btn-main:hover{background:#2ea043;}

  .btn-ghost{
    background:transparent;
    color:#58a6ff;
    border:1px solid #30363d;
  }
  .btn-ghost:hover{border-color:#58a6ff;}

  .sizes{
    display:flex;
    gap:8px;
    flex-wrap:wrap;
    margin-top:8px
  }

  .sizes button{
    font-size:12px;
    padding:7px 12px
  }

  #qrResult{
    margin-top:20px;
    display:flex;
    flex-direction:column;
    align-items:center;
  }

  #qrResult canvas{
    background:#ffffff;
    padding:10px;
    border-radius:12px;
  }

  .hint{
    font-size:12px;
    color:#8b949e;
    margin-top:8px
  }

  #volverHome{
    position:fixed;
    bottom:18px;
    right:18px;
    background:#238636;
    padding:12px 18px;
    font-size:14px;
    border-radius:12px;
    border:1px solid #2ea043;
    cursor:pointer;
    color:white;
    box-shadow:0 0 10px rgba(0,0,0,.4);
  }
  #volverHome:hover{
    background:#2ea043;
  }
</style>
</head>


<body>

<button id="volverHome" onclick="window.location.href='../home.html'"> Volver</button>

<header>
  <img src="../img/tmp-quality.png" alt="TMP" class="logo">
  <div>
    <h1>Generador de c贸digos QR</h1>
    <span class="sub">Trazabilidad de instrumentos 路 TMP</span>
  </div>
</header>

<div class="wrap">
  <div class="card">
    <h2>Instrumento</h2>

    <label for="codigo">C贸digo del instrumento</label>
    <input id="codigo" type="text" placeholder="Ejemplo: 11217">

    <div class="row">
      <button class="btn-main" onclick="generarQR()">Generar QR</button>
    </div>

    <div class="sizes">
      <button class="btn-ghost" onclick="setSize(5)">Etiqueta 5 mm</button>
      <button class="btn-ghost" onclick="setSize(7)">Etiqueta 7 mm</button>
      <button class="btn-ghost" onclick="setSize(10)">Etiqueta 10 mm</button>
    </div>

    <div id="qrResult"></div>

    <p class="hint">
      El QR generado apunta a la informaci贸n del instrumento almacenada en Supabase.
    </p>
  </div>
</div>


<!-- SCRIPT QR MEJORADO CON IMPRESIN -->
<script>
let qrSize = 200;

// URL correcta a tu ficha QR
const BASE_URL = "https://trazabilidad-tmp.vercel.app/qr/qr.info_instrumentos.html?codigo=";

/* =============================
   FUNCIN PARA IMPRIMIR ETIQUETA
============================= */
function imprimirEtiqueta(codigo, url, sizePx){
  const win = window.open("", "_blank", "width=400,height=400");

  win.document.write(`
    <html>
    <head>
    <style>
      body{
        margin:0;
        display:flex;
        flex-direction:column;
        align-items:center;
        justify-content:center;
        background:white;
        font-family:sans-serif;
      }
      img{width:${sizePx}px;height:${sizePx}px;}
      .code{margin-top:6px;font-size:14px;font-weight:bold;}
    </style>
    </head>

    <body>
      <img src="https://api.qrserver.com/v1/create-qr-code/?size=${sizePx}x${sizePx}&data=${encodeURIComponent(url)}">
      <div class="code">${codigo}</div>

      <script>
        window.onload = function(){
          setTimeout(()=>{ window.print(); }, 300);
        }
      <\/script>
    </body>
    </html>
  `);

  win.document.close();
}

/* =============================
   CAMBIO DE TAMAO + IMPRESIN
============================= */
function setSize(mm){
  const codigo = document.getElementById("codigo").value.trim();
  if (!codigo){
    alert("Introduce el c贸digo primero.");
    return;
  }

  // 1 mm = 8 px
  const sizePx = mm * 8;
  qrSize = sizePx;

  const url = BASE_URL + encodeURIComponent(codigo);

  generarQR();          // muestra QR en pantalla
  imprimirEtiqueta(codigo, url, sizePx);   // imprime
}

/* =============================
   GENERAR QR EN LA WEB
============================= */
function generarQR(){
  const codigo = document.getElementById("codigo").value.trim();
  if (!codigo){
    alert("Introduce el c贸digo del instrumento.");
    return;
  }

  const url = BASE_URL + encodeURIComponent(codigo);

  const cont = document.getElementById("qrResult");
  cont.innerHTML = "";

  const qrDiv = document.createElement("div");
  cont.appendChild(qrDiv);

  new QRCode(qrDiv, {
    text: url,
    width: qrSize,
    height: qrSize
  });

  const p = document.createElement("p");
  p.className = "hint";
  p.textContent = "URL codificada: " + url;
  cont.appendChild(p);
}
</script>

</body>
</html>

