<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>TMP · Generador QR (LEGIBLE)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>
body{
  background:#0b1220;
  color:#eaf2ff;
  font-family:system-ui,-apple-system,Segoe UI,sans-serif;
  display:flex;
  justify-content:center;
  padding:40px;
}
.card{
  background:#111c33;
  border-radius:18px;
  padding:24px;
  width:340px;
  box-shadow:0 20px 40px rgba(0,0,0,.6);
}
label{
  font-size:13px;
  color:#a0b3cc;
}
input{
  width:100%;
  padding:10px;
  margin-top:6px;
  border-radius:10px;
  border:1px solid #2a3556;
  background:#070b12;
  color:#fff;
  font-size:15px;
}
button{
  margin-top:12px;
  padding:10px;
  border-radius:999px;
  border:none;
  cursor:pointer;
  font-weight:800;
}
.btn-main{
  background:#22c55e;
  color:#04120a;
}
.sizes{
  display:flex;
  gap:8px;
  margin-top:12px;
}
.sizes button{
  flex:1;
  background:#1f2937;
  color:#cfe6ff;
}
.sizes button.active{
  background:#58a6ff;
  color:#041324;
}
.preview{
  margin-top:18px;
  display:flex;
  justify-content:center;
}
.qr-box{
  background:#fff;
  padding:12px;
}
.qr-box canvas{
  image-rendering: pixelated;
}
.caption{
  margin-top:10px;
  font-size:12px;
  color:#a0b3cc;
  text-align:center;
}
</style>
</head>

<body>

<div class="card">
  <label>Código del instrumento</label>
  <input id="codigo" placeholder="Ej: 11217">

  <button class="btn-main" onclick="generar()">Generar QR</button>

  <div class="sizes">
    <button class="active" onclick="setSize(10,this)">10 mm</button>
    <button onclick="setSize(13,this)">13 mm</button>
    <button onclick="setSize(15,this)">15 mm</button>
  </div>

  <div class="preview">
    <div class="qr-box" id="qr"></div>
  </div>

  <div class="caption" id="info"></div>
</div>

<script>
let sizeMM = 10;
const BASE_URL = "https://tmp-trazabilidad.netlify.app/qr/";

function mmToPx(mm){
  return Math.round(mm * 96 / 25.4);
}

function setSize(mm,btn){
  sizeMM = mm;
  document.querySelectorAll(".sizes button").forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");
  if(document.getElementById("codigo").value) generar();
}

function generar(){
  const code = document.getElementById("codigo").value.trim();
  if(!code) return alert("Introduce un código");

  const qrText = BASE_URL + code;
  const visiblePx = mmToPx(sizeMM);

  const container = document.getElementById("qr");
  container.innerHTML = "";

  // 1️⃣ QR GRANDE (HQ)
  const temp = document.createElement("div");
  new QRCode(temp,{
    text: qrText,
    width:600,
    height:600,
    correctLevel: QRCode.CorrectLevel.H
  });
  const bigCanvas = temp.querySelector("canvas");

  // 2️⃣ Canvas final EXACTO sin suavizado
  const finalCanvas = document.createElement("canvas");
  finalCanvas.width = visiblePx;
  finalCanvas.height = visiblePx;
  const ctx = finalCanvas.getContext("2d");
  ctx.imageSmoothingEnabled = false;
  ctx.drawImage(bigCanvas,0,0,visiblePx,visiblePx);

  container.appendChild(finalCanvas);

  document.getElementById("info").innerText =
    "URL en QR: " + qrText + " · Tamaño: " + sizeMM + "×" + sizeMM + " mm";
}
</script>

</body>
</html>
